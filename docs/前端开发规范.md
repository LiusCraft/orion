# 前端开发规范文档

## 文档信息
- **创建日期**: 2025-09-29
- **适用项目**: CDN AI Agent
- **技术栈**: React 18 + TypeScript + Ant Design + Tailwind CSS

## 1. 设计规范

### 1.1 色彩系统

#### 主色调
```css
/* 基于Ant Design的蓝色主题 */
--primary-color: #1677ff;      /* 主色 */
--primary-hover: #4096ff;      /* 主色悬停 */
--primary-active: #0958d9;     /* 主色激活 */
--primary-disabled: #a0d1ff;   /* 主色禁用 */
```

#### 辅助色
```css
--success-color: #52c41a;      /* 成功 */
--warning-color: #faad14;      /* 警告 */
--error-color: #ff4d4f;        /* 错误 */
--info-color: #1677ff;         /* 信息 */
```

#### 中性色
```css
--text-primary: #262626;       /* 主要文本 */
--text-secondary: #8c8c8c;     /* 次要文本 */
--text-disabled: #bfbfbf;      /* 禁用文本 */
--border-color: #d9d9d9;       /* 边框 */
--background: #ffffff;         /* 背景 */
--background-light: #fafafa;   /* 浅背景 */
```

### 1.2 字体规范

#### 字体族
```css
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
             'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
```

#### 字号层级
```css
--font-size-xs: 12px;     /* 辅助信息 */
--font-size-sm: 14px;     /* 正文小 */
--font-size-base: 16px;   /* 正文 */
--font-size-lg: 18px;     /* 小标题 */
--font-size-xl: 20px;     /* 标题 */
--font-size-2xl: 24px;    /* 大标题 */
--font-size-3xl: 32px;    /* 页面标题 */
```

#### 行高
```css
--line-height-tight: 1.25;   /* 标题 */
--line-height-normal: 1.5;   /* 正文 */
--line-height-loose: 1.75;   /* 大段落 */
```

### 1.3 间距规范

#### 基础间距单位
```css
--spacing-xs: 4px;
--spacing-sm: 8px;
--spacing-md: 16px;
--spacing-lg: 24px;
--spacing-xl: 32px;
--spacing-2xl: 48px;
--spacing-3xl: 64px;
```

#### 组件间距
- **按钮间距**: 8px
- **表单项间距**: 16px
- **卡片间距**: 24px
- **页面边距**: 32px

### 1.4 响应式断点

```css
/* 基于Tailwind CSS断点 */
--breakpoint-sm: 640px;    /* 平板 */
--breakpoint-md: 768px;    /* 小桌面 */
--breakpoint-lg: 1024px;   /* 桌面 */
--breakpoint-xl: 1280px;   /* 大桌面 */
--breakpoint-2xl: 1536px;  /* 超大桌面 */
```

## 2. 交互规范

### 2.1 Loading状态

#### 页面级Loading
```tsx
import { Spin } from 'antd';

const PageLoading = () => (
  <div className="flex items-center justify-center min-h-screen">
    <Spin size="large" tip="加载中..." />
  </div>
);
```

#### 组件级Loading
```tsx
import { Skeleton } from 'antd';

// 列表骨架屏
<Skeleton active paragraph={{ rows: 4 }} />

// 按钮Loading
<Button loading={isLoading}>提交</Button>
```

### 2.2 错误处理

#### 全局错误边界
```tsx
import { Result, Button } from 'antd';

const ErrorFallback = ({ error, resetError }: any) => (
  <Result
    status="error"
    title="页面出错了"
    subTitle={error.message}
    extra={
      <Button type="primary" onClick={resetError}>
        重新加载
      </Button>
    }
  />
);
```

#### 空状态
```tsx
import { Empty } from 'antd';

const EmptyState = ({ description = "暂无数据" }) => (
  <Empty description={description} />
);
```

### 2.3 消息提示

#### 统一消息API
```tsx
import { message, notification } from 'antd';

// 成功消息
message.success('操作成功');

// 错误消息
message.error('操作失败，请重试');

// 通知
notification.info({
  message: '系统通知',
  description: '您有新的消息',
  placement: 'topRight',
});
```

### 2.4 确认操作

#### 删除确认
```tsx
import { Modal } from 'antd';

const handleDelete = (id: string) => {
  Modal.confirm({
    title: '确认删除',
    content: '删除后无法恢复，确定要删除吗？',
    okText: '确定',
    cancelText: '取消',
    okType: 'danger',
    onOk: () => deleteItem(id),
  });
};
```

### 2.5 快捷键支持

#### 常用快捷键
- `Ctrl/Cmd + K`: 全局搜索
- `Ctrl/Cmd + Enter`: 提交表单
- `Escape`: 关闭弹窗
- `Tab/Shift+Tab`: 焦点导航

## 3. 组件规范

### 3.1 命名规范

#### 组件命名
```tsx
// ✅ 正确：PascalCase
const ChatMessage = () => {};
const KnowledgeBaseManager = () => {};

// ❌ 错误
const chatMessage = () => {};
const knowledge_base_manager = () => {};
```

#### 文件命名
```
components/
├── ChatMessage/
│   ├── index.tsx          # 主组件
│   ├── ChatMessage.tsx    # 同名组件文件
│   ├── types.ts           # 类型定义
│   └── styles.module.css  # 样式文件
```

### 3.2 Props接口定义

```tsx
// 基础Props接口
interface BaseComponentProps {
  className?: string;
  style?: React.CSSProperties;
  children?: React.ReactNode;
}

// 组件特定Props
interface ChatMessageProps extends BaseComponentProps {
  message: string;
  timestamp: Date;
  sender: 'user' | 'ai';
  isLoading?: boolean;
  onRetry?: () => void;
}

const ChatMessage: React.FC<ChatMessageProps> = ({
  message,
  timestamp,
  sender,
  isLoading = false,
  onRetry,
  className,
  ...rest
}) => {
  // 组件实现
};
```

### 3.3 通用组件库

#### 目录结构
```
src/
├── components/
│   ├── ui/                 # 基础UI组件
│   │   ├── Button/
│   │   ├── Input/
│   │   └── Modal/
│   ├── business/           # 业务组件
│   │   ├── ChatMessage/
│   │   ├── KnowledgeCard/
│   │   └── ToolPanel/
│   └── layout/             # 布局组件
│       ├── Header/
│       ├── Sidebar/
│       └── Layout/
```

#### 组件导出
```tsx
// components/index.ts
export { default as ChatMessage } from './business/ChatMessage';
export { default as KnowledgeCard } from './business/KnowledgeCard';
export { default as Button } from './ui/Button';
```

### 3.4 状态管理

#### 组件内状态
```tsx
import { useState, useEffect } from 'react';

const ChatMessage = () => {
  const [isVisible, setIsVisible] = useState(false);
  const [content, setContent] = useState('');
  
  useEffect(() => {
    // 副作用处理
  }, []);
  
  return <div>{content}</div>;
};
```

#### 全局状态 (使用Redux Toolkit)
```tsx
// store/chatSlice.ts
import { createSlice, PayloadAction } from '@reduxjs/toolkit';

interface ChatState {
  messages: Message[];
  isLoading: boolean;
}

const chatSlice = createSlice({
  name: 'chat',
  initialState,
  reducers: {
    addMessage: (state, action: PayloadAction<Message>) => {
      state.messages.push(action.payload);
    },
  },
});
```

## 4. 代码规范

### 4.1 TypeScript规范

#### 类型定义
```tsx
// types/api.ts
export interface ApiResponse<T = any> {
  code: number;
  message: string;
  data: T;
}

export interface User {
  id: string;
  name: string;
  email: string;
  role: 'admin' | 'user';
}

// 使用泛型
export interface PaginatedResponse<T> extends ApiResponse {
  data: {
    list: T[];
    total: number;
    page: number;
    pageSize: number;
  };
}
```

#### 严格类型检查
```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

### 4.2 ESLint配置

```json
// .eslintrc.json
{
  "extends": [
    "react-app",
    "react-app/jest",
    "@typescript-eslint/recommended",
    "prettier"
  ],
  "rules": {
    "react/jsx-filename-extension": [1, { "extensions": [".tsx"] }],
    "import/prefer-default-export": "off",
    "@typescript-eslint/explicit-function-return-type": "off",
    "@typescript-eslint/no-explicit-any": "warn"
  }
}
```

### 4.3 代码组织

#### 文件导入顺序
```tsx
// 1. React相关
import React, { useState, useEffect } from 'react';

// 2. 第三方库
import { Button, Form, Input } from 'antd';
import classNames from 'classnames';

// 3. 内部模块
import { useAppDispatch } from '@/hooks';
import { ChatMessage } from '@/components';
import { sendMessage } from '@/api/chat';

// 4. 类型定义
import type { Message, ChatState } from '@/types';

// 5. 样式文件
import styles from './ChatPanel.module.css';
```

#### Hook使用规范
```tsx
// 自定义Hook
const useChat = () => {
  const [messages, setMessages] = useState<Message[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  
  const sendMessage = useCallback(async (content: string) => {
    setIsLoading(true);
    try {
      const response = await api.sendMessage(content);
      setMessages(prev => [...prev, response.data]);
    } catch (error) {
      message.error('发送失败');
    } finally {
      setIsLoading(false);
    }
  }, []);
  
  return { messages, isLoading, sendMessage };
};
```

### 4.4 样式规范

#### Tailwind CSS使用
```tsx
// 优先使用Tailwind类名
const ChatMessage = ({ sender }: { sender: 'user' | 'ai' }) => (
  <div className={classNames(
    'flex p-4 rounded-lg shadow-sm',
    sender === 'user' ? 'bg-blue-50 ml-auto' : 'bg-gray-50',
    'max-w-[80%] mb-4'
  )}>
    {/* 内容 */}
  </div>
);
```

#### CSS Modules (必要时)
```css
/* ChatMessage.module.css */
.message {
  @apply flex p-4 rounded-lg shadow-sm mb-4;
  max-width: 80%;
}

.userMessage {
  @apply bg-blue-50 ml-auto;
}

.aiMessage {
  @apply bg-gray-50;
}
```

## 5. 性能规范

### 5.1 代码分割
```tsx
import { lazy, Suspense } from 'react';

// 路由级别分割
const ChatPage = lazy(() => import('@/pages/Chat'));
const KnowledgePage = lazy(() => import('@/pages/Knowledge'));

// 使用Suspense包装
const App = () => (
  <Suspense fallback={<PageLoading />}>
    <Routes>
      <Route path="/chat" element={<ChatPage />} />
      <Route path="/knowledge" element={<KnowledgePage />} />
    </Routes>
  </Suspense>
);
```

### 5.2 性能优化
```tsx
import { memo, useMemo, useCallback } from 'react';

// 组件记忆化
const ChatMessage = memo(({ message, sender }: ChatMessageProps) => {
  // 复杂计算使用useMemo
  const processedContent = useMemo(() => {
    return processMessage(message.content);
  }, [message.content]);
  
  // 事件处理使用useCallback
  const handleClick = useCallback(() => {
    onMessageClick(message.id);
  }, [message.id, onMessageClick]);
  
  return <div onClick={handleClick}>{processedContent}</div>;
});
```

## 6. 测试规范

### 6.1 单元测试
```tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { ChatMessage } from './ChatMessage';

describe('ChatMessage', () => {
  it('should render user message correctly', () => {
    render(
      <ChatMessage 
        message="Hello" 
        sender="user" 
        timestamp={new Date()} 
      />
    );
    
    expect(screen.getByText('Hello')).toBeInTheDocument();
  });
  
  it('should call onRetry when retry button is clicked', () => {
    const onRetry = jest.fn();
    render(
      <ChatMessage 
        message="Failed message" 
        sender="ai" 
        timestamp={new Date()}
        onRetry={onRetry}
      />
    );
    
    fireEvent.click(screen.getByText('重试'));
    expect(onRetry).toHaveBeenCalled();
  });
});
```

## 7. 文档规范

### 7.1 组件文档
```tsx
/**
 * 聊天消息组件
 * 
 * @example
 * ```tsx
 * <ChatMessage
 *   message="Hello, world!"
 *   sender="user"
 *   timestamp={new Date()}
 *   onRetry={() => console.log('retry')}
 * />
 * ```
 */
interface ChatMessageProps {
  /** 消息内容 */
  message: string;
  /** 发送者类型 */
  sender: 'user' | 'ai';
  /** 发送时间 */
  timestamp: Date;
  /** 是否加载中 */
  isLoading?: boolean;
  /** 重试回调 */
  onRetry?: () => void;
}
```

### 7.2 README.md
每个组件目录应包含README.md说明文件：

```markdown
# ChatMessage

聊天消息显示组件

## Props

| 属性 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| message | string | 是 | - | 消息内容 |
| sender | 'user' \| 'ai' | 是 | - | 发送者类型 |
| timestamp | Date | 是 | - | 发送时间 |
| isLoading | boolean | 否 | false | 是否加载中 |
| onRetry | () => void | 否 | - | 重试回调 |

## 使用示例

\`\`\`tsx
import { ChatMessage } from '@/components';

<ChatMessage
  message="Hello, world!"
  sender="user"
  timestamp={new Date()}
/>
\`\`\`
```

## 8. 工具链配置

### 8.1 开发环境配置

#### package.json scripts
```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint src --ext .ts,.tsx",
    "lint:fix": "eslint src --ext .ts,.tsx --fix",
    "format": "prettier --write \"src/**/*.{ts,tsx,css,md}\"",
    "type-check": "tsc --noEmit"
  }
}
```

#### Git hooks (husky)
```json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  },
  "lint-staged": {
    "*.{ts,tsx}": ["eslint --fix", "prettier --write"],
    "*.{css,md}": ["prettier --write"]
  }
}
```

---

**文档版本**: v1.0  
**最后更新**: 2025-09-29  
**维护人**: 前端团队